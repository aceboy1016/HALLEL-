# HALLEL 予約管理システム 完全利用マニュアル

このマニュアルは、HALLEL予約管理システムの使い方を**詳細に**説明します。
初めて使う方でも迷わず操作できるよう、ステップごとに丁寧に解説しています。

---

## 目次

1. [システム概要](#1-システム概要)
2. [閲覧ページ（お客様向け）](#2-閲覧ページお客様向け)
3. [管理者ログイン](#3-管理者ログイン)
4. [管理者ダッシュボード](#4-管理者ダッシュボード)
5. [カレンダー管理画面](#5-カレンダー管理画面)
6. [予約を追加する（詳細手順）](#6-予約を追加する詳細手順)
7. [予約を削除する（詳細手順）](#7-予約を削除する詳細手順)
8. [Gmail自動連携について](#8-gmail自動連携について)
9. [店舗別の設定と特徴](#9-店舗別の設定と特徴)
10. [よくある操作シナリオ](#10-よくある操作シナリオ)
11. [トラブルシューティング](#11-トラブルシューティング)
12. [セキュリティとメンテナンス](#12-セキュリティとメンテナンス)

---

## 1. システム概要

### 1.1 このシステムでできること

HALLEL予約管理システムは、全5店舗の予約状況を一元管理するWebアプリケーションです。

**主な機能:**
- ✅ リアルタイムで予約状況を確認（お客様向け）
- ✅ 手動で予約を追加・削除（管理者のみ）
- ✅ Gmailから自動で予約を取り込み
- ✅ 貸切予約の自動判別と表示
- ✅ 部屋・エリア別の予約管理
- ✅ 操作ログの記録と確認

### 1.2 対象店舗

| 店舗名 | 部屋・エリア | 最大収容 | 営業時間 |
|--------|-------------|---------|---------|
| 渋谷店 | なし（全体） | 7人 | 24時間 |
| 恵比寿店 | 個室A / 個室B | A:1人 / B:3人 | 24時間 |
| 半蔵門店 | STUDIO A / STUDIO B | A:1人 / B:3人 | 8:00-22:00 |
| 中目黒店 | 格闘技エリア / フリーウエイト | 格闘:1人 / フリー:3人 | 24時間 |
| 代々木上原店 | なし（全体） | 7人 | 24時間 |

### 1.3 アクセスURL

- **メインページ（店舗選択）**: `https://hallel-<プロジェクト名>.vercel.app/stores`
- **管理者ログイン**: `https://hallel-<プロジェクト名>.vercel.app/login`

> **💡 ヒント**: URLはブラウザのブックマーク（お気に入り）に登録しておくと便利です。

---

## 2. 閲覧ページ（お客様向け）

### 2.1 店舗選択ページ

#### アクセス方法
1. ブラウザで `/stores` にアクセス
2. 5つの店舗カードが表示されます

#### 画面構成
```
┌─────────────────────────────────┐
│  HALLEL 予約管理システム        │
├─────────────────────────────────┤
│                                 │
│  [渋谷店]    [恵比寿店]         │
│   SHIBUYA     EBISU             │
│                                 │
│  [半蔵門店]  [中目黒店]         │
│   HANZOMON    NAKAMEGURO        │
│                                 │
│  [代々木上原店]                 │
│   YOYOGI-UEHARA                 │
│                                 │
└─────────────────────────────────┘
```

#### 操作方法
- 見たい店舗のカードをクリック → その店舗の予約状況ページに移動

### 2.2 予約状況ページ

#### 画面の構成要素

**1. ヘッダー部分**
```
┌─────────────────────────────────┐
│ 📍 渋谷店 予約状況               │
│                                 │
│ [←] 2025年1月21日(火) [→]      │
│     📅 カレンダー選択            │
└─────────────────────────────────┘
```

- **店舗名**: 現在表示中の店舗
- **日付**: 表示中の日付
- **← →ボタン**: 前日・翌日に移動
- **📅 カレンダー**: クリックして任意の日付を選択

**2. タイムライン部分**

**【部屋なし店舗の場合（渋谷店・代々木上原店）】**

```
時刻    予約状況                           人数
──────────────────────────────────────────
08:00   [████████░░░░░░░░]               3/7人
        ↑緑色バー（空いている）

10:00   [████████████████░░]             5/7人
        ↑黄色バー（やや混雑）

14:00   [████████████████████]           7/7人
        ↑赤色バー（満枠）

16:00   [🔒 貸切利用]
        ↑貸切予約（全枠利用不可）
```

**【部屋あり店舗の場合（恵比寿・半蔵門・中目黒）】**

```
時刻    予約状況
──────────────────────────────────────────
08:00
  個室A（1人）:  [■]  満室
  個室B（3人）:  [□□□]  空室

10:00
  個室A（1人）:  [□]  空室
  個室B（3人）:  [■■□]  2/3人

14:00   🔒 貸切利用
        ↑全部屋が貸切
```

#### 色の意味

| 色 | 意味 | 予約率 |
|----|------|--------|
| 🟢 **緑色** | 空いています | 0-50% |
| 🟡 **黄色** | やや混雑 | 50-99% |
| 🔴 **赤色** | 満枠 | 100% |
| 🔒 **貸切利用** | 貸切予約 | - |

### 2.3 日付の切り替え方法

#### 方法1: 矢印ボタンを使う
- **← ボタン**: 前日に移動
- **→ ボタン**: 翌日に移動

#### 方法2: カレンダーから選ぶ
1. 📅 カレンダーアイコンをクリック
2. カレンダーが表示される
3. 見たい日付をクリック
4. 自動的にその日の予約状況が表示される

### 2.4 使用例

**例1: 明日の午前中が空いているか確認したい**
1. → ボタンをクリック（明日に移動）
2. タイムラインで08:00-12:00の時間帯を確認
3. 緑色なら空いている、赤色なら満枠

**例2: 来週月曜日の半蔵門店STUDIO Aの状況を確認したい**
1. 店舗選択で「半蔵門店」をクリック
2. 📅 カレンダーで来週月曜日をクリック
3. タイムラインで「STUDIO A」の列を確認

---

## 3. 管理者ログイン

### 3.1 ログインページへのアクセス

#### URL
```
https://hallel-<プロジェクト名>.vercel.app/login
```

#### 画面構成
```
┌─────────────────────────────────┐
│  🔐 管理者ログイン               │
├─────────────────────────────────┤
│                                 │
│  パスワード: [____________]     │
│                                 │
│  [ログイン]                      │
│                                 │
└─────────────────────────────────┘
```

### 3.2 ログイン手順

**ステップ1: パスワード入力欄をクリック**
- 入力欄が青く光ります

**ステップ2: パスワードを入力**
- 初期パスワード: `hallel0000admin`
- 入力中は `●●●●●●●●●●●●●●●●` のように表示されます

**ステップ3: ログインボタンをクリック**
- Enterキーでも可

**ステップ4: 成功すると管理者ダッシュボードに移動**

### 3.3 ログインできない場合

#### エラーメッセージと対処法

| エラーメッセージ | 原因 | 対処法 |
|----------------|------|--------|
| パスワードが正しくありません | パスワードが間違っている | パスワードを確認して再入力 |
| アカウントがロックされています | 5回連続でログイン失敗 | 15分待つ |
| セッションが切れました | ログイン状態が期限切れ | 再度ログイン |

### 3.4 初回ログイン後の推奨事項

⚠️ **重要**: 初回ログイン後、必ずパスワードを変更してください。

**理由:**
- 初期パスワードは誰でも知っている可能性がある
- セキュリティリスクが高い

**変更方法:**
→ [12.2 パスワード変更](#122-パスワード変更の手順) を参照

---

## 4. 管理者ダッシュボード

### 4.1 画面構成

ログイン後に表示される管理画面です。

```
┌─────────────────────────────────────────┐
│  HALLEL 管理者ダッシュボード             │
│  ログイン中: 管理者         [ログアウト]  │
├─────────────────────────────────────────┤
│                                         │
│  メニュー                                │
│  ┌─────────────────────────────────┐   │
│  │  📊 カレンダー管理                │   │
│  │  予約の追加・削除を行います        │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │  📋 アクティビティログ            │   │
│  │  操作履歴を確認します              │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │  🔑 パスワード変更                │   │
│  │  パスワードを変更します            │   │
│  └─────────────────────────────────┘   │
│                                         │
└─────────────────────────────────────────┘
```

### 4.2 各メニューの説明

#### 📊 カレンダー管理
- **機能**: 予約の追加・削除
- **クリックすると**: カレンダー管理画面に移動
- **使用頻度**: 最も高い（日常業務）

#### 📋 アクティビティログ
- **機能**: 操作履歴の確認
- **表示内容**:
  - ログイン履歴
  - 予約追加・削除の記録
  - 日時・IPアドレス・操作内容
- **使用頻度**: 定期確認（週1回程度）

#### 🔑 パスワード変更
- **機能**: 管理者パスワードの変更
- **使用頻度**: 初回および定期変更（3ヶ月ごと推奨）

### 4.3 ログアウト

**ログアウトボタンの場所:**
- 画面右上

**ログアウトする場面:**
- 作業が終わったとき
- 席を離れるとき
- 共用PCを使っているとき

---

## 5. カレンダー管理画面

### 5.1 画面へのアクセス

**方法1: ダッシュボードから**
1. 管理者ダッシュボードにログイン
2. 「📊 カレンダー管理」をクリック

**方法2: 直接URL**
```
/admin/calendar?store=shibuya
```

### 5.2 画面構成の詳細

```
┌──────────────────────────────────────────────────┐
│  HALLEL カレンダー管理              [ログアウト]  │
├──────────────────────────────────────────────────┤
│  [渋谷店] [恵比寿店] [半蔵門店] [中目黒店] [代々木上原店] ← タブ
├──────────────────────────────────────────────────┤
│  📅 2025年1月21日(火)  [←] [→] [カレンダー]      │
├──────────────────────────────────────────────────┤
│                                                  │
│  時刻  予約状況                                   │
│  ─────────────────────────────────────────────   │
│  08:00 □□□□□□□ (0/7人)  ← クリック可能       │
│  08:30 □□□□□□□ (0/7人)                       │
│  09:00 ■■□□□□□ (2/7人)                       │
│  09:30 ■■□□□□□ (2/7人) [山田太郎] [削除]    │
│         ↑既存予約（顧客名と削除ボタン表示）        │
│  10:00 [🔒 貸切] [削除]                          │
│         ↑貸切予約                                │
│                                                  │
└──────────────────────────────────────────────────┘
```

### 5.3 各部分の説明

#### 1. 店舗タブ
- **5つのタブ**: 渋谷店、恵比寿店、半蔵門店、中目黒店、代々木上原店
- **クリック**: 別の店舗に切り替え
- **現在の店舗**: 青色でハイライト

#### 2. 日付選択エリア
- **現在の日付**: 大きく表示
- **← → ボタン**: 前日・翌日に移動
- **📅 カレンダー**: 任意の日付を選択

#### 3. タイムライン
- **30分単位**: 00分と30分ごとに表示
- **空枠**: クリックして予約追加
- **既存予約**: 顧客名と削除ボタン表示

#### 4. 部屋別表示（恵比寿・半蔵門・中目黒のみ）

```
時刻    個室A（1人）      個室B（3人）
─────────────────────────────────────
08:00   □ 空室           □□□ 空室
08:30   ■ [田中] [削除]  □□□ 空室
09:00   □ 空室           ■■□ [佐藤][鈴木] [削除]
```

---

## 6. 予約を追加する（詳細手順）

### 6.1 基本的な流れ

```
1. 店舗を選ぶ
   ↓
2. 日付を選ぶ
   ↓
3. 時間帯をクリック
   ↓
4. 予約情報を入力
   ↓
5. 保存
```

### 6.2 詳細手順（通常予約の場合）

#### ステップ1: 店舗を選ぶ

1. カレンダー管理画面を開く
2. 画面上部のタブで店舗を選択
   - 例: 「恵比寿店」をクリック

#### ステップ2: 日付を選ぶ

1. 📅 カレンダーアイコンをクリック
2. 予約を入れたい日付をクリック
   - 例: 1月25日をクリック

#### ステップ3: 時間帯をクリック

1. タイムラインをスクロールして目的の時間帯を探す
   - 例: 14:00を探す
2. **空いている時間帯**をクリック
   - 空枠は □□□□□ のように表示されています
3. モーダルウィンドウ（入力画面）が開きます

#### ステップ4: 予約情報を入力

**【部屋がない店舗の場合（渋谷店・代々木上原店）】**

```
┌────────────────────────────────┐
│  予約を追加                     │
├────────────────────────────────┤
│                                │
│  開始時間: [14:00 ▼]           │
│            ↑クリックして時間選択│
│                                │
│  終了時間: [15:30 ▼]           │
│            ↑30分単位で選択     │
│                                │
│  顧客名: [山田太郎_______]      │
│          ↑任意（空欄でも可）   │
│                                │
│  [キャンセル]  [保存]          │
│                                │
└────────────────────────────────┘
```

**【部屋がある店舗の場合（恵比寿・半蔵門・中目黒）】**

```
┌────────────────────────────────┐
│  予約を追加                     │
├────────────────────────────────┤
│                                │
│  □ 貸切予約                    │
│    ↑チェックなし（通常予約）   │
│                                │
│  部屋 / エリア:                │
│  [個室A ▼]                     │
│   ↑必須！必ず選択してください  │
│                                │
│  開始時間: [14:00 ▼]           │
│  終了時間: [15:00 ▼]           │
│                                │
│  顧客名: [山田太郎_______]      │
│                                │
│  [キャンセル]  [保存]          │
│                                │
└────────────────────────────────┘
```

**入力のポイント:**

1. **部屋選択（部屋がある店舗のみ）**
   - ⚠️ **必須項目です**
   - ドロップダウンをクリック
   - リストから選択（例: 個室A、個室B）
   - 選択しないと「部屋を選択してください」とエラーが出ます

2. **開始時間**
   - ドロップダウンをクリック
   - 30分単位で選択（例: 08:00, 08:30, 09:00...）
   - クリックした時間帯が自動入力されています

3. **終了時間**
   - ドロップダウンをクリック
   - 開始時間より**後の時間**を選択
   - 30分単位で選択可能

4. **顧客名**
   - 任意入力（空欄でも保存可能）
   - 入力すると管理がしやすくなります
   - 例: 山田太郎、株式会社〇〇、田中様 など

#### ステップ5: 保存

1. 入力内容を確認
2. 「保存」ボタンをクリック
3. モーダルが閉じる
4. タイムラインに予約が反映される

**保存後の表示例:**
```
14:00 ■□□□□□□ (1/7人) [山田太郎] [削除]
14:30 ■□□□□□□ (1/7人) [山田太郎] [削除]
15:00 □□□□□□□ (0/7人)
```

### 6.3 詳細手順（貸切予約の場合）

#### 貸切予約とは？
- 施設全体を1組で貸し切る予約
- 他のお客様は利用できない
- タイムラインに「🔒 貸切利用」と表示される

#### 手順

**ステップ1-3**: 通常予約と同じ（店舗選択→日付選択→時間帯クリック）

**ステップ4: 貸切予約の入力**

```
┌────────────────────────────────┐
│  予約を追加                     │
├────────────────────────────────┤
│                                │
│  ☑ 貸切予約                    │
│    ↑ここをチェック！           │
│                                │
│  開始時間: [10:00 ▼]           │
│  終了時間: [12:00 ▼]           │
│                                │
│  顧客名: [株式会社〇〇____]     │
│          ↑任意                 │
│                                │
│  [キャンセル]  [保存]          │
│                                │
└────────────────────────────────┘
```

**重要なポイント:**
- ✅ 「貸切予約」チェックボックスを**必ずON**にする
- ✅ 部屋選択は**不要**（自動的に非表示になります）
- ✅ 開始・終了時間を入力
- ✅ 保存

**保存後の表示:**
```
10:00 [🔒 貸切利用] [削除]
10:30 [🔒 貸切利用] [削除]
11:00 [🔒 貸切利用] [削除]
11:30 [🔒 貸切利用] [削除]
12:00 □□□□□□□ (0/7人)
```

### 6.4 予約時間の設定ルール

#### 時間の単位
- **30分単位**で設定可能
- 例: 10:00, 10:30, 11:00, 11:30...

#### 時間の範囲

| 店舗 | 表示時間帯 |
|------|----------|
| 渋谷店 | 0:00-24:00 |
| 恵比寿店 | 0:00-24:00 |
| 半蔵門店 | **8:00-22:00** |
| 中目黒店 | 0:00-24:00 |
| 代々木上原店 | 0:00-24:00 |

#### 時間の長さ
- **最短**: 30分（例: 10:00-10:30）
- **最長**: 制限なし（例: 10:00-20:00）
- **推奨**: 1-2時間程度

### 6.5 よくある入力ミス

| ミス | エラーメッセージ | 対処法 |
|------|----------------|--------|
| 部屋を選択していない | 「部屋を選択してください」 | ドロップダウンから部屋を選択 |
| 終了時間が開始時間より前 | 「終了時間は開始時間より後にしてください」 | 終了時間を修正 |
| 空欄のまま保存 | - | 最低限、開始・終了時間は必須 |

---

## 7. 予約を削除する（詳細手順）

### 7.1 基本的な流れ

```
1. 店舗を選ぶ
   ↓
2. 日付を選ぶ
   ↓
3. 削除したい予約を探す
   ↓
4. 削除ボタンをクリック
   ↓
5. 確認して削除実行
```

### 7.2 詳細手順

#### ステップ1: 店舗を選ぶ

1. カレンダー管理画面を開く
2. 削除したい予約がある店舗のタブをクリック
   - 例: 「恵比寿店」

#### ステップ2: 日付を選ぶ

1. 📅 カレンダーで該当日を選択
2. タイムラインが更新される

#### ステップ3: 削除したい予約を探す

1. タイムラインをスクロール
2. 削除したい予約を見つける

**予約の表示例:**
```
【通常予約】
09:00 ■□□□□□□ (1/7人) [山田太郎] [削除]
      ↑顧客名         ↑削除ボタン

【貸切予約】
14:00 [🔒 貸切利用] [削除]
                   ↑削除ボタン

【部屋別予約（恵比寿店など）】
10:00
  個室A: ■ [田中一郎] [削除]
             ↑顧客名  ↑削除ボタン
```

#### ステップ4: 削除ボタンをクリック

1. 該当の予約の「削除」ボタンをクリック
2. 確認ダイアログが表示される

**確認ダイアログ:**
```
┌────────────────────────────────┐
│  予約を削除しますか？           │
├────────────────────────────────┤
│                                │
│  この操作は取り消せません。     │
│                                │
│  [キャンセル]  [OK]            │
│                                │
└────────────────────────────────┘
```

#### ステップ5: 削除を実行

1. 「OK」ボタンをクリック
2. 予約が削除される
3. タイムラインから予約が消える

**削除後:**
```
【削除前】
09:00 ■□□□□□□ (1/7人) [山田太郎] [削除]

【削除後】
09:00 □□□□□□□ (0/7人)
      ↑空枠に戻る
```

### 7.3 削除できない場合

#### ケース1: 削除ボタンが表示されない
**原因**: ログインしていない
**対処法**: `/login` から再ログイン

#### ケース2: 「削除」をクリックしても反応しない
**原因**: 通信エラーまたはセッション切れ
**対処法**:
1. ページを再読み込み（F5キー）
2. 再度ログイン

#### ケース3: 「予約が見つかりません」エラー
**原因**: 別の店舗の予約を選択している
**対処法**: 店舗タブを確認して正しい店舗を選択

### 7.4 削除の注意点

⚠️ **重要な注意事項:**

1. **削除は取り消せません**
   - 一度削除すると元に戻せない
   - 削除前に必ず確認

2. **貸切予約の削除**
   - 貸切予約を削除すると、その時間帯が全て空枠になる
   - 複数の時間帯にまたがる場合、すべての時間帯が一度に削除される

3. **間違って削除した場合**
   - 手動で再度追加する必要がある

---

## 8. Gmail自動連携について

### 8.1 仕組みの概要

Google Apps Script (GAS) が自動的にGmailをチェックし、予約メールを検出してシステムに登録します。

```
Gmail受信
   ↓
GASが定期実行（10分または1時間ごと）
   ↓
予約メールを検出
   ↓
予約情報を抽出（日付・時間・部屋名・貸切フラグ）
   ↓
Vercelサーバーに送信
   ↓
データベースに保存
   ↓
予約状況ページに自動反映
```

### 8.2 自動で処理されるメール

#### 対象メール
- **件名**に「予約」「確認」などのキーワードを含む
- **本文**に日付・時間・部屋名の情報がある
- **7日以内**に受信したメール

#### 抽出される情報

**1. 日付**
- 形式: 2025年1月21日、2025/01/21、1月21日 など

**2. 時間**
- 形式: 14:00-15:30、14時00分〜15時30分 など

**3. 部屋名**
- 例: STUDIO A、個室B、格闘技エリア など

**4. 貸切判定**
- メール本文に「**貸切利用**」が含まれる場合、自動的に貸切予約として登録

**5. 顧客名**
- メール本文から氏名を抽出（可能な場合）

### 8.3 自動処理の例

#### 例1: 通常予約メール

**メール内容:**
```
件名: 予約確認

いつもご利用ありがとうございます。

以下の予約を承りました：

日時: 2025年1月25日 14:00-15:30
施設: HALLEL恵比寿店
部屋: 個室A
お名前: 山田太郎様
```

**自動処理結果:**
- 店舗: 恵比寿店
- 日付: 2025年1月25日
- 時間: 14:00-15:30
- 部屋: 個室A
- 顧客名: 山田太郎
- タイプ: 通常予約（gmail）

#### 例2: 貸切予約メール

**メール内容:**
```
件名: 【STUDIO】貸切利用 90分

予約情報：

日時: 2025年1月28日 18:00-19:30
施設: HALLEL中目黒店
内容: 【STUDIO】貸切利用 90分
```

**自動処理結果:**
- 店舗: 中目黒店
- 日付: 2025年1月28日
- 時間: 18:00-19:30
- 部屋: なし（貸切）
- タイプ: **貸切予約（charter）**

#### 例3: キャンセルメール

**メール内容:**
```
件名: 予約キャンセル

以下の予約をキャンセルいたしました：

日時: 2025年1月25日 14:00-15:30
施設: HALLEL恵比寿店
```

**自動処理結果:**
- 該当予約を自動削除

### 8.4 手動追加が必要な場合

以下の場合は、GASで自動処理できないため、**手動で予約を追加**してください：

❌ **自動処理できないケース:**
- 電話で受けた予約
- SNSやLINEで受けた予約
- メール形式が特殊で情報を抽出できない
- 日付・時間の記載形式が特殊
- 店舗名が明記されていない

### 8.5 自動連携の確認方法

#### 予約が自動登録されたか確認する

1. カレンダー管理画面を開く
2. 該当の店舗・日付を選択
3. タイムラインを確認
4. 予約が表示されていれば成功

#### アクティビティログで確認

1. 管理者ダッシュボード → アクティビティログ
2. 「Gmail予約追加」などのログを確認
3. 日時・内容を確認

---

## 9. 店舗別の設定と特徴

### 9.1 渋谷店

**基本情報:**
- 部屋: なし（全体での管理）
- 最大収容: 7人
- 営業時間: 24時間

**予約時の注意:**
- 部屋選択不要
- 全体の人数のみ管理

**表示例:**
```
10:00 ████████████░░░░ 5/7人
```

---

### 9.2 恵比寿店

**基本情報:**
- 部屋: 個室A（1人）/ 個室B（3人）
- 営業時間: 24時間

**部屋の詳細:**
| 部屋名 | 表示名 | 最大収容 |
|--------|--------|---------|
| 個室A | 個室A | 1人 |
| 個室B | 個室B | 3人 |

**予約時の注意:**
- ⚠️ 部屋選択が**必須**
- 部屋ごとに独立して予約管理

**表示例:**
```
10:00
  個室A（1人）: ■ 満室
  個室B（3人）: ■■□ 2/3人
```

---

### 9.3 半蔵門店

**基本情報:**
- 部屋: STUDIO A（個室、1人）/ STUDIO B（オープン、3人）
- **営業時間: 8:00-22:00**（他店と異なる！）

**部屋の詳細:**
| 部屋名 | 表示名 | 最大収容 | タイプ |
|--------|--------|---------|--------|
| 個室A | STUDIO A（個室） | 1人 | 個室 |
| 個室B | STUDIO B（オープン） | 3人 | オープン |

**予約時の注意:**
- ⚠️ 部屋選択が**必須**
- ⚠️ **8:00-22:00のみ予約可能**
- それ以外の時間帯はタイムラインに表示されません

**表示例:**
```
【管理画面】
08:00
  STUDIO A（個室）: □ 空室
  STUDIO B（オープン）: □□□ 空室

22:00 ← ここまで表示
（22:00以降は表示されない）
```

**営業時間外の予約:**
- 22:00-翌8:00は予約不可
- システム上、時間帯が表示されません

---

### 9.4 中目黒店

**基本情報:**
- エリア: 格闘技エリア（1人）/ フリーウエイトエリア（3人）
- 営業時間: 24時間

**エリアの詳細:**
| エリア名 | 表示名 | 最大収容 |
|----------|--------|---------|
| 格闘技エリア | 格闘技エリア | 1人 |
| フリーウエイトエリア | フリーウエイトエリア | 3人 |

**予約時の注意:**
- ⚠️ エリア選択が**必須**
- エリアごとに独立して予約管理

**表示例:**
```
10:00
  格闘技エリア（1人）: ■ 満室
  フリーウエイトエリア（3人）: □□□ 空室
```

---

### 9.5 代々木上原店

**基本情報:**
- 部屋: なし（全体での管理）
- 最大収容: 7人
- 営業時間: 24時間

**予約時の注意:**
- 部屋選択不要（渋谷店と同じ）
- 全体の人数のみ管理

**表示例:**
```
10:00 ████████████░░░░ 5/7人
```

---

## 10. よくある操作シナリオ

### 10.1 シナリオ1: 電話予約を手動登録

**状況:**
お客様から電話で「明日14時から1時間、恵比寿店の個室Aを予約したい」と連絡があった。

**操作手順:**

1. 管理者ログイン
2. カレンダー管理画面を開く
3. 「恵比寿店」タブをクリック
4. → ボタンで明日の日付に移動
5. 14:00の時間帯をクリック
6. 入力画面で：
   - 貸切予約: チェックなし
   - 部屋: 個室A
   - 開始時間: 14:00
   - 終了時間: 15:00
   - 顧客名: （お客様の名前）
7. 保存ボタンをクリック

✅ 完了！予約が登録されました。

---

### 10.2 シナリオ2: 貸切予約を3時間で登録

**状況:**
企業から「来週金曜日の18時から21時まで、半蔵門店を貸切りたい」と依頼があった。

**操作手順:**

1. 管理者ログイン
2. カレンダー管理画面 → 半蔵門店タブ
3. カレンダーで来週金曜日を選択
4. 18:00の時間帯をクリック
5. 入力画面で：
   - ☑ **貸切予約にチェック**
   - 開始時間: 18:00
   - 終了時間: 21:00
   - 顧客名: 株式会社〇〇
6. 保存

✅ 18:00-21:00が貸切予約として登録されます。

---

### 10.3 シナリオ3: 急なキャンセル対応

**状況:**
お客様から「今日14時の予約をキャンセルしたい」と電話があった。

**操作手順:**

1. カレンダー管理画面を開く
2. 該当店舗のタブを選択
3. 今日の日付を確認（自動的に今日が表示されているはず）
4. 14:00の時間帯を探す
5. 該当予約の「削除」ボタンをクリック
6. 確認ダイアログで「OK」

✅ 予約が削除され、枠が空きました。

---

### 10.4 シナリオ4: 複数の予約を一度に登録

**状況:**
同じお客様が「毎週月曜日10時から1ヶ月分予約したい」と依頼（計4回）

**操作手順:**

**1回目:**
1. カレンダーで今週月曜日を選択
2. 10:00をクリック → 予約登録

**2回目:**
1. → ボタンを7回押して次の月曜日に移動
2. 10:00をクリック → 予約登録

**3回目、4回目も同様に繰り返す**

💡 **ヒント**: 顧客名を同じにしておくと、後で確認しやすい

---

### 10.5 シナリオ5: 満枠状況を確認して別の時間帯を提案

**状況:**
お客様から「明日14時から1時間」と希望。満枠だったら別の時間を提案したい。

**操作手順:**

1. カレンダー管理画面で該当店舗・明日を表示
2. 14:00の時間帯を確認

**ケースA: 満枠の場合**
```
14:00 ████████████████████ 7/7人 満枠
```
→ 前後の時間帯を確認
```
13:00 ████████░░░░░░░░ 3/7人 ← 空いている
15:00 ████████░░░░░░░░ 3/7人 ← 空いている
```
→ お客様に「13時または15時なら空いています」と提案

**ケースB: 空いている場合**
```
14:00 ████████░░░░░░░░ 3/7人
```
→ 予約を登録

---

### 10.6 シナリオ6: 部屋を間違えて登録した場合

**状況:**
個室Aで登録すべきところを、個室Bで登録してしまった。

**操作手順:**

1. **間違った予約を削除**
   - 該当予約の「削除」ボタンをクリック

2. **正しい予約を再登録**
   - 同じ時間帯をクリック
   - 正しい部屋を選択
   - 保存

💡 **ヒント**: 削除してから登録するまでの間、他の予約が入る可能性があるため、素早く操作する

---

## 11. トラブルシューティング

### 11.1 ログイン関連

#### 問題1: パスワードを入力しても「パスワードが正しくありません」

**考えられる原因:**
- パスワードが間違っている
- 大文字・小文字を間違えている
- スペースが入っている

**対処法:**
1. パスワードを再確認
   - 初期パスワード: `hallel0000admin`
   - 大文字・小文字を正確に
2. コピー&ペーストを試す
3. それでもダメなら、システム管理者に連絡

---

#### 問題2: 「アカウントがロックされています」

**原因:**
- 5回連続でログイン失敗

**対処法:**
- **15分間待つ**
- 自動的にロック解除されます
- 15分後に再度ログイン

---

#### 問題3: ログインしたのに管理画面が表示されない

**原因:**
- セッションエラー
- ブラウザのCookieが無効

**対処法:**
1. ブラウザを再起動
2. Cookieを有効にする
3. 再度ログイン

---

### 11.2 予約追加関連

#### 問題4: 「部屋を選択してください」エラー

**原因:**
- 部屋がある店舗で部屋を選択していない

**対処法:**
1. 「部屋 / エリア」のドロップダウンをクリック
2. リストから部屋を選択
3. 再度保存

**該当店舗:**
- 恵比寿店
- 半蔵門店
- 中目黒店

---

#### 問題5: 保存ボタンを押しても反応しない

**原因:**
- 通信エラー
- 必須項目が入力されていない

**対処法:**
1. 以下を確認：
   - 開始時間が入力されているか
   - 終了時間が入力されているか
   - 部屋が選択されているか（部屋がある店舗の場合）
2. ページを再読み込み（F5キー）
3. 再度操作

---

#### 問題6: 時間帯をクリックしても入力画面が開かない

**原因:**
- ログインしていない
- JavaScriptエラー

**対処法:**
1. 再ログイン
2. ブラウザを再起動
3. 別のブラウザで試す（Chrome、Edge、Safariなど）

---

### 11.3 予約削除関連

#### 問題7: 「削除に失敗しました」エラー

**原因:**
- 予約が見つからない
- 既に削除されている
- 通信エラー

**対処法:**
1. ページを再読み込み
2. 予約が本当に存在するか確認
3. 店舗タブが正しいか確認

---

#### 問題8: 削除ボタンが表示されない

**原因:**
- ログインしていない
- 閲覧ページ（管理画面ではない）を開いている

**対処法:**
1. URLを確認
   - 管理画面: `/admin/calendar`
   - 閲覧ページ: `/store/shibuya`
2. 管理画面を開く
3. ログインする

---

### 11.4 表示関連

#### 問題9: 予約を追加したのに反映されない

**原因:**
- ページが更新されていない
- 別の日付を表示している
- 別の店舗を表示している

**対処法:**
1. ページを再読み込み（F5キー）
2. 日付を確認
3. 店舗タブを確認
4. それでも表示されない場合：
   - 本当に保存されたか確認
   - もう一度追加してみる

---

#### 問題10: タイムラインが空白

**原因:**
- データ読み込みエラー
- 通信エラー

**対処法:**
1. ページを再読み込み
2. インターネット接続を確認
3. 数分待ってから再度アクセス

---

### 11.5 Gmail連携関連

#### 問題11: 予約メールが来ているのに自動登録されない

**原因:**
- GASのトリガーが停止している
- メール形式が対応していない
- 7日以上前のメール

**対処法:**
1. **まず手動で登録する**（急ぎの場合）
2. システム管理者に連絡
3. GASのトリガー設定を確認してもらう

---

#### 問題12: 貸切予約が通常予約として登録された

**原因:**
- メール本文に「貸切利用」が含まれていなかった

**対処法:**
1. 該当予約を削除
2. 手動で貸切予約として再登録

---

### 11.6 その他

#### 問題13: 画面が崩れて表示される

**原因:**
- ブラウザが古い
- CSSの読み込みエラー

**対処法:**
1. ブラウザを最新版に更新
2. ページを再読み込み
3. キャッシュをクリア

---

#### 問題14: スマホで操作しづらい

**原因:**
- 画面サイズが小さい

**対処法:**
1. 横向きにする
2. PCで操作する（推奨）
3. タブレットを使う

---

## 12. セキュリティとメンテナンス

### 12.1 セキュリティのベストプラクティス

#### パスワード管理

✅ **推奨事項:**
1. **複雑なパスワードを使用**
   - 最低12文字以上
   - 大文字・小文字を含む
   - 数字を含む
   - 記号を含む
   - 例: `Hallel2025!Mgmt`

2. **定期的に変更**
   - 3ヶ月ごとに変更
   - 推測されやすいパスワードは避ける
   - 例: `hallel123`、`password` など

3. **他人と共有しない**
   - パスワードは個人で管理
   - メモに書く場合は安全な場所に保管

#### ログイン・ログアウト

✅ **推奨事項:**
1. **共用PCでは必ずログアウト**
   - 作業が終わったら必ずログアウト
   - 席を離れるときもログアウト

2. **不審なログイン履歴を確認**
   - アクティビティログを定期的に確認
   - 不審なIPアドレスからのアクセスがないか確認

#### ブラウザのセキュリティ

✅ **推奨事項:**
1. **HTTPS接続を確認**
   - URLが `https://` で始まっているか確認
   - 鍵マークが表示されているか確認

2. **最新のブラウザを使用**
   - Chrome、Edge、Safari、Firefoxの最新版

### 12.2 パスワード変更の手順

#### 手順

**ステップ1: ダッシュボードを開く**
1. 管理者ログイン
2. ダッシュボードが表示される

**ステップ2: パスワード変更画面を開く**
1. 「🔑 パスワード変更」をクリック

**ステップ3: 現在のパスワードを入力**
```
┌────────────────────────────────┐
│  パスワード変更                 │
├────────────────────────────────┤
│                                │
│  現在のパスワード:              │
│  [_______________]             │
│                                │
│  新しいパスワード:              │
│  [_______________]             │
│                                │
│  新しいパスワード（確認）:       │
│  [_______________]             │
│                                │
│  [変更する]                     │
│                                │
└────────────────────────────────┘
```

1. 現在のパスワードを入力

**ステップ4: 新しいパスワードを入力**
1. 新しいパスワードを入力（2回）
2. 2回とも同じパスワードを入力

**パスワード要件:**
- 最低12文字以上
- 大文字を含む
- 小文字を含む
- 数字を含む
- 記号を含む

**ステップ5: 変更を実行**
1. 「変更する」ボタンをクリック
2. 成功メッセージが表示される

**ステップ6: 新しいパスワードでログイン**
1. 一度ログアウト
2. 新しいパスワードでログイン
3. 成功すれば完了

### 12.3 アクティビティログの確認

#### アクティビティログとは？
- システム上の全ての操作を記録
- ログイン、予約追加、削除などを追跡

#### 確認方法

1. 管理者ダッシュボード → 「📋 アクティビティログ」

#### ログの見方

```
日時                    操作内容                  IPアドレス
────────────────────────────────────────────────────────
2025-01-21 14:30:25    ログイン成功              192.168.1.100
2025-01-21 14:32:10    予約追加（恵比寿店）       192.168.1.100
2025-01-21 14:35:45    予約削除（渋谷店）         192.168.1.100
2025-01-21 15:00:00    ログアウト                192.168.1.100
```

#### 確認すべきポイント

1. **不審なログイン**
   - 知らない時間帯のログイン
   - 知らないIPアドレス

2. **不審な操作**
   - 身に覚えのない予約追加・削除
   - 大量の操作

3. **ログイン失敗**
   - 連続したログイン失敗
   - 不正アクセスの可能性

#### 定期確認の推奨

- **頻度**: 週1回
- **確認日**: 毎週月曜日の朝など
- **所要時間**: 5-10分

### 12.4 バックアップとメンテナンス

#### データのバックアップ

現在のシステムでは、PostgreSQLデータベースに全データが保存されています。

**推奨事項:**
- システム管理者に月1回のバックアップを依頼
- 重要なイベント前後はバックアップを取る

#### システムの更新

**推奨事項:**
- システム管理者が定期的に更新
- セキュリティパッチの適用

---

## 13. サポートと連絡先

### 13.1 問題が解決しない場合

#### 技術サポート
- **GitHub Issues**: システムのバグ報告
- **URL**: https://github.com/aceboy1016/HALLEL-/issues

#### システム管理者
- **緊急時**: システム管理者に直接連絡
- **対応時間**: 平日9:00-18:00

### 13.2 よくある質問

**Q: システムの利用料金は？**
A: Vercelの無料枠内で運用している場合は無料です。

**Q: データはいつまで保存される？**
A: データベースに永続的に保存されます。削除しない限り残ります。

**Q: 複数人で同時に使える？**
A: はい、複数の管理者が同時にログインして操作できます。

**Q: スマホからでも使える？**
A: はい、スマホでも利用できますが、PCでの利用を推奨します。

---

## 14. クイックリファレンス

### 14.1 主要なURL

| ページ | URL |
|--------|-----|
| 店舗選択 | `/stores` |
| 管理者ログイン | `/login` |
| 管理ダッシュボード | `/admin` |
| カレンダー管理 | `/admin/calendar?store=店舗ID` |

**店舗ID:**
- `shibuya` - 渋谷店
- `ebisu` - 恵比寿店
- `hanzomon` - 半蔵門店
- `nakameguro` - 中目黒店
- `yoyogiuehara` - 代々木上原店

### 14.2 操作一覧

| 操作 | 手順 |
|------|------|
| 予約状況を見る | `/stores` → 店舗選択 → 日付選択 |
| ログイン | `/login` → パスワード入力 → ログイン |
| 予約を追加（通常） | カレンダー管理 → 店舗選択 → 日付選択 → 時間帯クリック → 部屋選択 → 時間入力 → 保存 |
| 予約を追加（貸切） | カレンダー管理 → 店舗選択 → 日付選択 → 時間帯クリック → 貸切チェックON → 時間入力 → 保存 |
| 予約を削除 | カレンダー管理 → 店舗選択 → 日付選択 → 予約の削除ボタン → OK |
| パスワード変更 | 管理ダッシュボード → パスワード変更 → 現在のパスワード → 新しいパスワード → 変更 |
| ログを確認 | 管理ダッシュボード → アクティビティログ |
| ログアウト | 画面右上のログアウトボタン |

### 14.3 店舗別設定一覧

| 店舗 | 部屋・エリア | 最大収容 | 営業時間 | 部屋選択 |
|------|------------|---------|---------|---------|
| 渋谷店 | なし | 7人 | 24時間 | 不要 |
| 恵比寿店 | 個室A / 個室B | 1人 / 3人 | 24時間 | **必須** |
| 半蔵門店 | STUDIO A / B | 1人 / 3人 | **8:00-22:00** | **必須** |
| 中目黒店 | 格闘技 / フリーウエイト | 1人 / 3人 | 24時間 | **必須** |
| 代々木上原店 | なし | 7人 | 24時間 | 不要 |

### 14.4 エラーメッセージ早見表

| エラーメッセージ | 対処法 |
|----------------|--------|
| パスワードが正しくありません | パスワードを確認して再入力 |
| アカウントがロックされています | 15分待つ |
| 部屋を選択してください | 部屋のドロップダウンから選択 |
| 終了時間は開始時間より後にしてください | 終了時間を修正 |
| 削除に失敗しました | ページを再読み込み |
| セッションが切れました | 再ログイン |

---

**最終更新**: 2025-01-21
**バージョン**: 2.0（詳細版）
**対象システム**: HALLEL 予約管理システム（全店舗対応版）
**作成者**: システム管理部門

---

## 付録: 用語集

| 用語 | 意味 |
|------|------|
| タイムライン | 時間帯ごとの予約状況を表示するエリア |
| モーダル | 画面上に重なって表示される入力ウィンドウ |
| ドロップダウン | クリックすると選択肢が表示される入力形式 |
| GAS | Google Apps Script（Gmail連携用のスクリプト） |
| 貸切予約 | 施設全体を1組で貸し切る予約 |
| セッション | ログイン状態を保持する仕組み |
| Cookie | ブラウザに保存される小さなデータ |
| HTTPS | 暗号化された安全な通信プロトコル |

---

このマニュアルで不明な点があれば、システム管理者にお問い合わせください。
